并发查询
## 1 ClickHouse概述
### 1.1 是什么
列式数据库管理系统 , 主要用于在线分析处理查询（OLAP）。

- 联机事务处理OLTP（on-line transaction processing）
OLTP是传统的关系型数据库的主要应用，主要是基本的、日常的事务处理，例如银行交易。
- 联机分析处理OLAP（On-Line Analytical Processing）
OLAP是数据仓库系统的主要应用，支持复杂的分析操作，侧重决策支持，并且提供直观易懂的查询结果。

总的来说，OLTP就是面向我们的应用系统数据库的，OLAP是面向数据仓库的。
### 1.2 应用场景
1. 绝大多数为读访问请求
2. 数据更新为大批量更新或不更新
3. 不需要事务
4. 数据一致性要求较低 [原子性 持久性 一致性 隔离性]
5. 适合在线查询

### 1.3 优缺点
#### 优点
1. 速度快（多核心并行处理）
2. 功能多（支持数据统计分析各种场景）
   1. 支持类SQL查询；
   2. 支持繁多库函数（例如IP转化，URL分析等）；
   3. 支持数组和嵌套数据结构；
   4. 支持数据库异地复制部署。
3. 底层数据列式存储,支持压缩
4. 多服务器分布式处理数据

#### 缺点
1. 不支持事务
2. 缺少完整的Update/Delete操作
3. 不支持高并发
## 2 ClickHouse架构



### ClickHouse 主键索引【联合索引、排序键】
ClickHouse 不要求主键唯一，所以您可以插入多条具有相同主键的行。
主键的构成，同样可以存在函数表达式。如，（CounterID，EventDate，intHash32（UserID））
#### ClickHouse 的索引优化
1.分区，原则是尽量把经常一起用到的数据放到相同区
2.主键（索引，即排序）order by字段选择

#### 建索引的正确方式
开始字段不应该是区分度很高的字段，如果是唯一的，那么索引效果非常差，也不能找区分度特别差的，应该找区分度中等